steps: 
  - script: poetry run pytest --junitxml=junit/test-results.xml --cov-report=xml
    env:
      FORESHADOW_TESTS: ALL
    displayName: Run pytest
  - task: PublishTestResults@2
    inputs:
      testResultsFiles: 'junit/test-results.xml'
      testRunTitle: '$(Agent.OS) - $(Build.BuildNumber)[$(Agent.JobName)] - Python $(python.version)'
    condition: succeededOrFailed()
  - task: PublishCodeCoverageResults@1
    inputs:
      codeCoverageTool: Cobertura
      summaryFileLocation: '$(System.DefaultWorkingDirectory)/**/coverage.xml'
      reportDirectory: '$(System.DefaultWorkingDirectory)/**/htmlcov'
  - task: BuildQualityChecks@6
    inputs:
      checkCoverage: true
      coverageFailOption: 'fixed'
      coverageType: 'branches'
      coverageThreshold: '75'
    displayName: 'Check build quality'